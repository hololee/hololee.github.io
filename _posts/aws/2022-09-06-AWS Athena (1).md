---
title: AWS Athena ì‚¬ìš©ê¸° (1)
date: 2022-09-06 19:40:00 +0900
categories: [aws]
tags: [aws, athena]     # TAG names should always be lowercas
img_path: /
---

# AWS Athena

AI ëª¨ë¸ì—ì„œ ë‚˜ì˜¨ ì¶”ë¡  ë°ì´í„°ë¥¼ AWS RDSë¡œ ì¦‰ì„ìœ¼ë¡œ ë„£ì–´ì£¼ê³  ìˆì—ˆë‹¤.

RDSì„œë²„ê°€ scale-outìœ¼ë¡œ ì¸í•œ ì—°ê²° ìˆ˜ ì¦ê°€ì™€ ì…ë ¥ ë°ì´í„°ëŸ‰ì´ ì»¤ì§ì— ë”°ë¼ ëª¨ë‹ˆí„°ë§ì´ í•„ìš”í•´ì§€ê³  RDS ìì²´ë„ ìŠ¤ì¼€ì¼ë§ì´ í•„ìš”í•´ì§€ì ë§ì€ ì¶”ë¡ ë°ì´í„°ë¥¼ ê´€ë¦¬í•  ë°©ë²•ì´ í•„ìš”í•´ì¡Œë‹¤.



ë°ì´í„° ë°œìƒ ìƒí™©ì€ ì•„ë˜ì™€ ê°™ì•˜ë‹¤.

- 1ì´ˆë‹¹ 30Mb ì •ë„ì˜ ì…ì¶œë ¥ì´ í•„ìš”í•˜ë‹¤.
  - ì¿¼ë¦¬ ìì²´ëŠ” ì‘ì§€ë§Œ ìƒë‹¹íˆ ë§ì€ ìˆ˜`> 1ë§Œ` ì˜ ë™ì‹œ ì ‘ì†ìê°€ ë°œìƒí•œë‹¤.
- ì ‘ì†ì ìˆœê°„ íŠ¸ë ˆí”½ì´ ë†’ì•„ì„œ RDSì˜ ìŠ¤ì¼€ì¼ë§ì´ ìì£¼ í•„ìš”í•˜ë‹¤.



ì´ë•Œ ë‘ê°€ì§€ ë¬¸ì œì ì´ ë°œìƒí•˜ëŠ”ë°,

1. RDSì˜ ìœ ì§€ë¹„ìš©ì´ í¬ê²Œ ë“¤ì–´ê°„ë‹¤.
2. RDS scalingì´ ìì£¼ ì¼ì–´ë‚˜ê³  ê·¸ì— ë”°ë¼ì„œ ë°ì´í„° ì €ì¥ ë¶ˆì•ˆì •ì„±ì´ í¬ê²Œ ëŠ˜ì–´ë‚œë‹¤.



ê·¸ë˜ì„œ ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œ ë‹¤ì–‘í•œ ë°©ë²•ë“¤ì„ ê³ ë¯¼í•´ë³´ì•˜ë‹¤.

- Data warehouse(DW)ë¡œ AWS redshiftë¥¼ ì‚¬ìš©í•˜ê³  apache airflowë¥¼ í†µí•´ì„œ ë¡œê·¸ë¥¼ redshiftì— ì €ì¥.
- ë¡œê·¸ ìì²´ë¥¼ S3ì— ì €ì¥í•˜ê³  S3 selection, AWS athena, Redshift Spectrum ì´ìš©í•˜ê¸°



ì´ì¤‘ì— ìƒˆë¡­ê²Œ ì•Œê²Œëœ ì‚¬ì‹¤ì´ ìˆì—ˆëŠ”ë° ì•„ë˜ í•­ëª©ì— í•´ë‹¹í•˜ëŠ” ë°©ë²•ë“¤ì€ RDBMSë¥¼ êµ¬ì„±í•˜ì§€ ì•Šê³  s3ì— ì˜¬ë¼ê°€ìˆëŠ” íŠ¹ì • í˜•íƒœì˜ ë°ì´í„°ë“¤ì„ í†µí•´ì„œ ì¿¼ë¦¬ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì½ì–´ì˜¬ ìˆ˜ ìˆì—ˆë‹¤. (ì´ë ‡ê²Œ ë˜ë©´ ì €ì¥ ìš©ë„ì˜ ë¡œê·¸ëŠ” ì´í¸ì´ ì´ë“!)

ë‹¨ì ìœ¼ë¡œëŠ” ì¿¼ë¦¬ë¥¼ ë‚ ë¦´ë•Œ tableë¡œ ì§€ì •ëœ ë²„í‚·ì„ ìŠ¤ìº”í•˜ê²Œ ë˜ëŠ”ë° ì´ë•Œ partitioningì´ ì œëŒ€ë¡œ ë˜ì–´ìˆì§€ ì•Šì€ìƒíƒœë¡œ ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ê²Œ ë˜ë©´ ë¹„ìš©ì´ ë§ì´ ì²­êµ¬ëœë‹¤... (ì´ê²Œ ì§„ì§œ ë¬´ì„­ë‹¤.. ğŸ¥²)



## Athenaì˜ íŠ¹ì§•

ìš°ì„  athenaë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ì „ì— athenaì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì•˜ë‹¤. ìƒì†Œí–ˆë˜ ë¶€ë¶„ ìœ„ì£¼ë¡œ ì‘ì„±í•˜ë ¤ê³  í•œë‹¤.

> Athenaì— ê´€ë ¨í•œ ìì„¸í•œ ì •ë³´ëŠ” referenceì˜ *Amazon Athena ì„¤ëª…ì„œ*ì—ì„œ ìì„¸í•˜ê²Œ ë³¼ ìˆ˜ ìˆë‹¤.



#### ê¶Œí•œ

Athenaë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ì„œ ê´€ë ¨ ê¶Œí•œì´ í•„ìš”í–ˆë‹¤. ë‚˜ëŠ” Athenaì™€ Glue ì„œë¹„ìŠ¤ì— ëŒ€í•œ ê¶Œí•œì„ ìš”ì²­í•˜ì˜€ë‹¤.



#### SQL

Amazon AthenaëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ë¶„ì‚° SQL ì—”ì§„ì¸ Prestoë¥¼ ì‚¬ìš©í•œë‹¤. 

ì˜ ëª¨ë¥´ëŠ” ì—”ì§„ì´ì˜€ê³  data typeì´ë‚˜ ì—¬ëŸ¬ sql ê´€ë ¨ í•¨ìˆ˜ë‚˜ ë¬¸ë²•ì€ AWS í™ˆí˜ì´ì§€ì— ì˜ ë‚˜ì™€ìˆë‹¤.



#### Database & Table

AWS Glueì˜ ë°ì´í„° ì¹´íƒˆë¡œê·¸ë¥¼ ë³´ë©´ Databaseì™€ Tableì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ì´ë•Œ Tableì— S3ì˜ íŠ¹ì • ìœ„ì¹˜ë¥¼ ë“±ë¡í•˜ë©´ í•´ë‹¹ ìœ„ì¹˜ì— ìˆëŠ” íŒŒì¼ë“¤ì„ ë°ì´í„°ë¡œ ì½ì„ ìˆ˜ ìˆë‹¤.

ì—¬ê¸°ì„œ `SerDe` ë¼ëŠ” ìƒì†Œí•œ ë‚´ìš©ì´ í•˜ë‚˜ ë” ë‚˜ì˜¤ê²Œ ëœë‹¤.



#### S3ì— ì €ì¥ëœ ë°ì´í„°ì˜ í˜•íƒœ

AthenaëŠ” `CSV`, `JSON`, `Avro`, `Parquet`ê³¼ í•¨ê»˜ ê¸°íƒ€ í˜•ì‹ë„ ì§€ì›í•œë‹¤. ë‚˜ëŠ” jsonì„ ì´ìš©í•˜ì˜€ëŠ”ë° ì—¬ëŸ¬ ë‹¤ë¥¸ íŒŒì¼í˜•ì‹ë„ ì´ìš©í•´ë³´ë©´ ì¢‹ì„ê²ƒ ê°™ë‹¤.(ìƒí™©ì— ë§ì¶°ì„œ..)

##### SerDe

SerDe(Serializer/Deserializer)ëŠ” Athenaê°€ ë‹¤ì–‘í•œ í˜•ì‹ì˜ ë°ì´í„°ì™€ ìƒí˜¸ ì‘ìš©í•˜ëŠ” í•œ ë°©ì‹ì´ë¼ê³  í•œë‹¤. ì¦‰ S3ì— ì €ì¥ëœ íŒŒì¼ì— ë”°ë¼ì„œ SerDeë¥¼ ì˜ ì§€ì •í•´ì¤˜ì•¼ íŒŒì¼ì„ ì˜ ì½ì„ ìˆ˜ ìˆë‹¤. ì•„ë˜ëŠ” JSONì— ëŒ€í•œ SerDeë¥¼ ì ìš©í•˜ëŠ” ì˜ˆì‹œì´ë‹¤.

```sql
CREATE TABLE selling (..)
ROW FORMAT SERDE 'org.apache.hive.hcatalog.data.JsonSerDe'
```



## Database & Table ì„¤ì •

Athenaë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” AWS Glueë¥¼ í†µí•´ì„œ Databaseì™€ tableì„ ìƒì„±í•´ì£¼ì–´ì•¼ í•œë‹¤.

GlueëŠ” AWSì˜ ETL(Extract, Tramsform, Load) ì„œë¹„ìŠ¤ë¡œ ì—¬ëŸ¬ ê¸°ëŠ¥ë“¤ì„ ì§€ì›í•œë‹¤. ì—¬ê¸°ì„œëŠ” s3ì˜ íŠ¹ì • ìœ„ì¹˜ë¥¼ tableë¡œ ì§€ì •í•˜ëŠ” ì‘ì—…ì„ í•´ë³´ë ¤ê³  í•œë‹¤.

> ê°œì¸ì ìœ¼ë¡œ <u>í”„ë¡œê·¸ë˜ë¨¸ìŠ¤ ìŠ¤ì¿¨</u>ì—ì„œ ì§„í–‰í•˜ëŠ” [ì‹¤ë¦¬ì½˜ ë°¸ë¦¬ì—ì„œ ë‚ ì•„ì˜¨ ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§ ìŠ¤íƒ€í„° í‚¤íŠ¸](https://school.programmers.co.kr/learn/courses/14783)ë¥¼ ë“¤ì—ˆëŠ”ë° ETLê³¼ ê´€ë ¨í•œ ë‹¤ì–‘í•œ ì •ë³´ë¥¼ ì ‘í•  ìˆ˜ ìˆê³  ë°ì´í„° í˜„ì—…ì ë¶„ë“¤ê³¼ ì†Œí†µí•  ìˆ˜ ìˆì–´ì„œ ì¢‹ì•˜ë˜ê²ƒ ê°™ë‹¤. (ì™œ ê´‘ê³  ê°™ì§€;;)



### 0. ë¹„ìš©ì„ ì¤„ì´ê¸° ìœ„í•œ ì¥ì¹˜

ì•ì„œ ë§í•œê²ƒì²˜ëŸ¼ AthenaëŠ” S3ë¥¼ ìŠ¤ìº”í•˜ëŠ” ìš©ëŸ‰ë§Œí¼ ë¹„ìš©ì´ ì²­êµ¬ëœë‹¤. 

ìŠ¤ìº”í•˜ëŠ” ë°ì´í„°ì˜ ìš©ëŸ‰ê³¼ ì–‘ì„ ì¤„ì¼ìˆ˜ë¡ ì¿¼ë¦¬ì‹œ ì§€ì¶œë˜ëŠ” ë¹„ìš©ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤. ì´ë¥¼ ìœ„í•´ì„œ ì—¬ëŸ¬ê°€ì§€ ì¥ì¹˜ë“¤ì„ ì œê³µí•˜ëŠ”ë° ê°€ì¥ ì ‘ê·¼í•˜ê¸° ì‰¬ìš´ê²ƒì´ ì•„ë˜ì˜ ë‘ê°€ì§€ ì´ë‹¤. ì—¬ê¸°ì„œëŠ” partitionë§Œ ì ìš©í•´ë³´ë ¤ê³  í•œë‹¤.

- partition
- compression



#### partition

Athenaì—ì„œ partitionì€ ìë™, ìˆ˜ë™ ë‘ê°€ì§€ ë°©ì‹ì´ ì œê³µëœë‹¤. ì—¬ê¸°ì„œëŠ” ìë™&Hive ìŠ¤íƒ€ì¼ íŒŒí‹°ì…˜ì„ ì´ìš©í•  ê²ƒì´ë©° ìë™ ë°©ì‹ì€ S3 ë²„í‚·ì˜ ë””ë ‰í„°ë¦¬ì— ëª…ì‹œì ìœ¼ë¡œ partioningì„ ì§€ì •í•´ì£¼ë©´ ëœë‹¤.

ìë™ì˜ ê²½ìš°ì—ëŠ” Hive ìŠ¤íƒ€ì¼ íŒŒí‹°ì…˜ê³¼ ë¹„ Hive ìŠ¤íƒ€ì¼ íŒŒí‹°ì…˜ë¡œ ë‚˜ë‰˜ëŠ”ë° Hive ìŠ¤íƒ€ì¼ íŒŒí‹°ì…˜ì´ ë” ê°„ë‹¨í•˜ê¸° ë•Œë¬¸ì— (ì‚¬ì‹¤ ê¸°ì¡´ì— ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ ì´ë ‡ê²Œ ì‚¬ìš©ì¤‘ì´ë¼ì„œ..) Hive ìŠ¤íƒ€ì¼ íŒŒí‹°ì…˜ìœ¼ë¡œ ì ìš©í•˜ì˜€ë‹¤.

Athena ì‚¬ìš© ì„¤ëª…ì„œì—ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•˜ë¼ê³  í•œë‹¤.

> AthenaëŠ” Apache Hive ìŠ¤íƒ€ì¼ íŒŒí‹°ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ íŒŒí‹°ì…˜ì˜ ë°ì´í„° ê²½ë¡œì— ë“±í˜¸ë¡œ ì—°ê²°ëœ í‚¤ ê°’ í˜ì–´ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤(ì˜ˆ: `country=us/...` ë˜ëŠ” `year=2021/month=01/day=26/...`). ë”°ë¼ì„œ ê²½ë¡œì—ëŠ” íŒŒí‹°ì…˜ í‚¤ì˜ ì´ë¦„ê³¼ ê° ê²½ë¡œê°€ ë‚˜íƒ€ë‚´ëŠ” ê°’ì´ ëª¨ë‘ í¬í•¨ë©ë‹ˆë‹¤. 

ë°”ë¡œ ì•„ë˜ì— ë‹¤ìŒê³¼ ê°™ì€ êµ¬ë¬¸ì´ ìˆëŠ”ë° ì´ê²Œ ë§¤ìš° ì¤‘ìš”í•˜ë‹¤. ë‚˜ëŠ” ì´ë¶€ë¶„ì„ ì§€ë‚˜ì³ì„œ ë°ì´í„°ê°€ ë¡œë“œê°€ ì•ˆë˜ê³  ë°ì´í„° íƒ€ì…ê³¼ table ìƒì„±ì´ ì˜ëª»ëœ ë¬¸ì œë¡œ ì°©ê°í•˜ê³  ì‹œê°„ì„ ë§ì´ ë‚­ë¹„í•˜ì˜€ë‹¤. (ì—­ì‹œ ë¬¸ì„œë¥¼ ì˜ ì½ì–´ì•¼ í•œë‹¤..)

> íŒŒí‹°ì…˜ì„ ë‚˜ëˆˆ í…Œì´ë¸”ì— ìƒˆ Hive íŒŒí‹°ì…˜ì„ ë¡œë“œí•˜ë ¤ë©´ [MSCK REPAIR TABLE](https://docs.aws.amazon.com/ko_kr/athena/latest/ug/msck-repair-table.html) ëª…ë ¹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©° ì´ ëª…ë ¹ì€ Hive ìŠ¤íƒ€ì¼ íŒŒí‹°ì…˜ì—ì„œë§Œ ì‘ë™í•©ë‹ˆë‹¤.

ì´ë¶€ë¶„ì— ëŒ€í•´ì„œëŠ” ì•„ë˜ì—ì„œ ë‹¤ì‹œí•  ì˜ˆì •ì´ë‹¤.



### 1. AWS Glueì—ì„œ Data Catalog ì„¤ì •í•˜ê¸°

awsì˜ ê²€ìƒ‰ì— Glueë¡œ ê²€ìƒ‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì´ ë‚˜ì˜¤ëŠ”ë° ì¢Œì¸¡ì˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ë©´ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì„ ë³¼ ìˆ˜ ìˆë‹¤. ì¢Œì¸¡ì— ìˆëŠ” Database, Tableì„ ì„¤ì •í•´ì£¼ë©´ ëœë‹¤.

> crawlers ë“±ì„ í†µí•´ì„œ s3ì—ì„œ ì›í•˜ëŠ” ë¶€ë¶„ë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤ëŠ”ë° ì•„ì§ ì¡°ì‚¬ê°€ ì•ˆë˜ì–´ì„œ ì¼ë‹¨ pass í•´ë³¸ë‹¤.



![image-20220906173400732](assets/img/posts/image-20220906173400732.png)



Databaseì˜ ìƒì„±ì€ ë§¤ìš° ê°„ë‹¨í•˜ë‹¤. ì•„ë˜ì˜ í•­ëª©ë“¤ì„ ì…ë ¥í•˜ê³  ìƒì„±í•´ì£¼ë©´ ëœë‹¤.

![image-20220907113348313](assets/img/posts/image-20220907113348313.png)

Tableì˜ ê²½ìš°ì—ëŠ” ì¡°ê¸ˆë” ë³µì¡í•œë° ì‚¬ì‹¤ ë³„ê±° ì—†ë‹¤. ì´ 3ê°œì˜ ìŠ¤í…ìœ¼ë¡œ ë‚˜ë‰˜ì–´ ìˆë‹¤.

![image-20220907113452516](assets/img/posts/image-20220907113452516.png)



ë‘ë²ˆì§¸ ìŠ¤íƒ­ì—ì„œ í…Œì´ë¸”ì„ ì •ì˜í•´ì£¼ëŠ”ë° ìœ„ì—ì„œ ì–¸ê¸‰í–ˆë˜ê²ƒì²˜ëŸ¼ íŒŒí‹°ì…˜ì„ ì ìš©í•˜ëŠ” ì»¬ëŸ¼ë“¤ì˜ ê²½ìš°ì—ëŠ” `Partition key`ì— ì²´í¬ë¥¼ í•´ì£¼ì–´ì•¼ í•œë‹¤.

![image-20220907113617816](assets/img/posts/image-20220907113617816.png)

![image-20220907113657936](assets/img/posts/image-20220907113657936.png)



### 2. Athena ì½˜ì†”ì—ì„œ ì¿¼ë¦¬ë¡œ ìƒì„±í•˜ê¸°

Glueì˜ Data Catalog ì½˜ì†”ì´ ì•„ë‹Œ Athenaì˜ ì½˜ì†”ì—ì„œë„ ë°”ë¡œ Databaseì™€ Tableì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

Databaseë¥¼ ìƒì„±ì€ ì•„ë˜ì™€ ê°™ì´ í•  ìˆ˜ ìˆë‹¤.

```sql
CREATE DATABASE car;
```



Tableì€ ì¡°ê¸ˆë” ì‹ ê²½ì¨ì•¼ í•œë‹¤. S3ì— ì €ì¥ë˜ì–´ìˆëŠ” íŒŒì¼ì˜ êµ¬ì¡°ì— ë”°ë¼ ì‘ì„±í•´ì•¼í•˜ê³  partitionë„ ì‹ ê²½ì¨ì£¼ì–´ì•¼ í•œë‹¤.

ìš°ì„  `s3://car_books/logs` ìœ„ì¹˜ì— ë‹¤ìŒê³¼ ê°™ì€ json íŒŒì¼ì´ ì €ì¥ë˜ì–´ìˆë‹¤ê³  ê°€ì •í•œë‹¤.

> Json ì•ˆì— Json í•­ëª©ì´ ìˆëŠ” ê²½ìš° ì—¬ëŸ¬ê°€ì§€ ë°©ë²•ì„ ì‹œë„í•´ë³´ì•˜ëŠ”ë° prestoì˜ json í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì ìš©í•˜ì˜€ë‹¤. ì•„ë˜ì²˜ëŸ¼ ë°ì´í„°ë¡œ ë“¤ì–´ê°€ëŠ” jsonì€ ë¬¸ìì—´ í˜•íƒœë¡œ ì €ì¥í•œë‹¤. í•œì¤„ì— json í•˜ë‚˜ì”© ì‘ì„±í•˜ë©´ ëœë‹¤.

~~~json
{"type": "sedan", "manufactured" : "2010-07-30 08:00:00", "year": 2022, "month": 8, "day": 16, "accident" : 0, "option" : "{\"sun_loop\": 1, \"navi\": 1}"}
{"type": "suv", "manufactured" : "2012-01-23 09:13:00", "year": 2022, "month": 8, "day": 16, "accident" : 3, "option" : "{\"sun_loop\": 0, \"navi\": 1}"}
~~~



ì´ë•Œ í…Œì´ë¸”ì€ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•  ìˆ˜ ìˆë‹¤. í…Œì´ë¸”ì„ ìƒì„±í• ë•ŒëŠ” `EXTERNAL`ë¡œ ì„¤ì •ì„ í•´ì£¼ì–´ì•¼ í•œë‹¤.
ì£¼ì˜í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ íŒŒí‹°ì…˜ì˜ ì§€ì •ê³¼ íŒŒì¼ì„ ì½ê¸°ìœ„í•œ SerDeì˜ ì„¤ì • ë¶€ë¶„ì´ë‹¤.

> Athena ì½˜ì†”ì—ì„œ table ìƒì„±ì‹œì—ëŠ” ì¢Œì¸¡ì— ë°ì´í„° ë©”ë‰´ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì˜ ì„¤ì •ë˜ì–´ìˆëŠ”ì§€ ì‚´í´ë³´ì.

```sql
CREATE EXTERNAL TABLE selling (
  type string,
  manufactured timestamp,
  accident integer,
  option string
) 
PARTITIONED BY (
  year integer,
  month integer,
  day integer
)
ROW FORMAT SERDE 'org.apache.hive.hcatalog.data.JsonSerDe'
LOCATION 's3://car_books/logs';
```



ì—­ì‹œ ì—¬ê¸°ì„œë„ ë¬¸ì œê°€ ë°œìƒí–ˆì—ˆëŠ”ë° íŒŒí‹°ì…˜ìœ¼ë¡œ ë“±ë¡í•˜ê³ ì í•˜ëŠ” ì»¬ëŸ¼ì€ Table ì»¬ëŸ¼ì—ì„œ ë¹¼ì£¼ì–´ì•¼í•œë‹¤. ì¤‘ë³µìœ¼ë¡œ ì ìš©í•˜ëŠ” ê²½ìš° ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

~~~
FAILED: SemanticException [Error 10035]: Column repeated in partitioning columns
~~~



### 3. íŒŒí‹°ì…˜ ë¦¬í”„ë ˆì‹œ

ì´ì œ íŒŒí‹°ì…˜ì„ Athenaê°€ ì¸ì‹í•  ìˆ˜ ìˆë„ë¡ ì§€ì • í•´ì£¼ì–´ì•¼ í•œë‹¤. íŒŒí‹°ì…˜ì´ ì¸ì‹ë˜ê¸° ì „ê¹Œì§€ëŠ” ì¿¼ë¦¬ë¥¼ ì•„ë¬´ë¦¬ ë‚ ë ¤ë„ ì¡°íšŒê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤. (ë‚˜ëŠ” ì´ë¶€ë¶„ì„ ì§€ë‚˜ì³ì„œ ì˜¤ëœì‹œê°„ì„ ë‚­ë¹„í–ˆë‹¤..)

~~~sql
MSCK REPAIR TABLE car.selling;
~~~

~~~
Partitions not in metastore: selling:year=2022/month=8/day=16
Repair: Added partition to metastore car.selling:year=2022/month=8/day=16
~~~



## ì¿¼ë¦¬ TEST

ì•ì„œ ë§í•œê²ƒì²˜ëŸ¼ AthenaëŠ” ì¿¼ë¦¬ì‹œ ìŠ¤ìº”í•œ ë¹„ìš©ë§Œí¼ ë¹„ìš©ì´ ì§€ë¶ˆëœë‹¤. ë”°ë¼ì„œ í…ŒìŠ¤íŠ¸í• ë•ŒëŠ” limitì„ ì§€ì •í•´ì£¼ëŠ”ê²ƒì´ ì¢‹ë‹¤.

~~~sql
SELECT * 
FROM car.selling 
LIMIT 5;
~~~



ì•ì„œ ì„¤ì •í•œ json ë³€ìˆ˜ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„œëŠ” prestoì˜ json í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

~~~sql
SELECT 
	json_extract(option, '$.sun_loop') sun_loop,
	json_extract(option, '$.navi') sun_loop,
FROM car.selling 
LIMIT 5;
~~~





#### p.s.

- ì•ì„œ ì‚¬ìš©í•œ tableì¸ `car.selling`ì€ `"car"."selling"`ê³¼ ê°™ì´ ì‘ì„±í•´ë„ ëœë‹¤.



#### Reference

- [Amazon Athena ì„¤ëª…ì„œ](https://docs.aws.amazon.com/ko_kr/athena/latest/ug/what-is.html)
- [Amazon Athena ì„¤ëª…ì„œ - ì••ì¶• ì§€ì›](https://docs.aws.amazon.com/ko_kr/athena/latest/ug/compression-formats.html)
- [Amazon Athena ì„¤ëª…ì„œ - SerDe ì‚¬ìš©](https://docs.aws.amazon.com/ko_kr/athena/latest/ug/serde-about.html)
- [Amazon Athena ì„¤ëª…ì„œ - ë°ì´í„° ë¶„í• ](https://docs.aws.amazon.com/ko_kr/athena/latest/ug/partitions.html)
- [Presto 0.276 Documentation](https://prestodb.io/docs/current/functions/json.html)
- [Amazon Athena ì´ˆê°„ë‹¨ ì‚¬ìš©ê¸° - Amazon Web Services í•œêµ­ ë¸”ë¡œê·¸](https://aws.amazon.com/ko/blogs/korea/amazon-athena-sql-compatible-query-series/)
- [AWS Athenaë¥¼ ì‚¬ìš©í•´ì„œ S3 ë°ì´í„° ì¡°íšŒí•´ë³´ì -  ë²ˆê°œì¥í„°](https://www.theteams.kr/teams/7937/post/70685)
- [Amazon S3 Select ë° Glacier Select - Amazon Web Services í•œêµ­ ë¸”ë¡œê·¸](https://aws.amazon.com/ko/blogs/korea/s3-glacier-select/)
- [Amazon Redshift Spectrumì„ ì‚¬ìš©í•˜ì—¬ ì™¸ë¶€ ë°ì´í„° ì¿¼ë¦¬](https://docs.aws.amazon.com/ko_kr/redshift/latest/dg/c-using-spectrum.html)
